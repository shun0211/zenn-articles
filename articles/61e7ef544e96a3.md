---
title: "LangGraph UI ã‚’æ´»ç”¨ã—ãŸ NextJS Ã— LangGraph AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºã‚¬ã‚¤ãƒ‰"
emoji: "ğŸ¨"
type: "tech"
topics: ["LangGraph", "AI", "LangChain", "NextJS", "LLM"]
published: true
publication_name: "egghead"
---

ã“ã‚“ã«ã¡ã¯ã€é…’äº•ã§ã™ï¼
[æ ªå¼ä¼šç¤¾ EGGHEAD](https://egghead.co.jp?utm_source=zenn&utm_medium=social&utm_campaign=normal)ï¼ˆã‚¨ãƒƒã‚°ãƒ˜ãƒƒãƒ‰ï¼‰ã¨ã„ã†ã€Œè£½é€ æ¥­ã§ç”Ÿæˆ AI ã‚’æ´»ç”¨ã—ãŸã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã€ã‚’ã—ã¦ã„ã‚‹ä¼šç¤¾ã®ä»£è¡¨ã‚’ã—ã¦ãŠã‚Šã¾ã™ã€‚

https://egghead.co.jp?utm_source=zenn&utm_medium=social&utm_campaign=normal

ã“ã®è¨˜äº‹ã§ã¯ã€LangGraph UI ã‚’ä½¿ã£ã¦ AI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡å˜ã«æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚LangGraph UI ã¯ã€LangChain ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹ UI æ§‹ç¯‰ã®ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€LangGraph ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ãŸ AI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’å¤§å¹…ã«åŠ¹ç‡åŒ–ã§ãã¾ã™ã€‚

https://langchain-ai.github.io/langgraph/cloud/how-tos/generative_ui_react

## ã“ã®è¨˜äº‹ã®å†…å®¹

- LangGraph UI ã‚’ä½¿ã£ãŸãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬çš„ãªä½œã‚Šæ–¹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚„ç·¨é›†æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•

## ç’°å¢ƒæº–å‚™

ã¾ãšã€Next.js ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
$ npx create-next-app@latest
```

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ™‚ã«ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚ã“ã®è¾ºã‚Šã¯å¥½ã¿ã®è¨­å®šã§å•é¡Œãªã„ã§ã™ã€‚

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: chatbot-sandbox
- TypeScript: Yes
- ESLint: Yes
- Tailwind CSS: Yes
- src/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: Yes
- App Router: Yes
- Turbopack: Yes
- Import alias: Yes

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ç«‹ã¡ä¸Šã’ã¦ãŠãã¾ã™ã€‚

```bash
$ npm run dev
```

## LangGraph UI ã®è¨­å®š

### 1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
$ npm install @langchain/langgraph-sdk @langchain/core
```

### 2. langgraph.json ã®è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`langgraph.json`ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ¥ç¶šè¨­å®šã‚’å®šç¾©ã—ã¾ã™ã€‚

```json
{
  "dependencies": ["."],
  "graphs": {
    "agent": "./backend/agent.py:graph"
  },
  "ui": {
    "agent": "./src/app/agent/ui.tsx"
  }
}
```

### 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…

`backend/agent.py`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ãªå¤©æ°—æƒ…å ±ã‚’è¿”ã™ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```python
import uuid
from typing import Annotated, Sequence, TypedDict

from langchain_core.messages import AIMessage, BaseMessage
from langchain_openai import ChatOpenAI
from langgraph.graph import StateGraph
from langgraph.graph.message import add_messages
from langgraph.graph.ui import AnyUIMessage, ui_message_reducer, push_ui_message

class AgentState(TypedDict):
    messages: Annotated[Sequence[BaseMessage], add_messages]
    ui: Annotated[Sequence[AnyUIMessage], ui_message_reducer]

async def weather(state: AgentState):
    class WeatherOutput(TypedDict):
        city: str

    weather: WeatherOutput = (
        await ChatOpenAI(model="gpt-4-mini")
        .with_structured_output(WeatherOutput)
        .with_config({"tags": ["nostream"]})
        .ainvoke(state["messages"])
    )

    message = AIMessage(
        id=str(uuid.uuid4()),
        content=f"Here's the weather for {weather['city']}",
    )

    push_ui_message("weather", weather, message=message)
    return {"messages": [message]}

workflow = StateGraph(AgentState)
workflow.add_node(weather)
workflow.add_edge("__start__", "weather")
graph = workflow.compile()
```

### 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®åŸºæœ¬å®Ÿè£…

`src/app/page.tsx`ã‚’ä½œæˆã—ã€åŸºæœ¬çš„ãªãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
LangGraph UIã®ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ã®ãŒã€`useStream`ã§`langgraph.json`ã§å®šç¾©ã—ãŸGraphåã‚’`assistantId`ã«æŒ‡å®šã—ã¾ã™ã€‚ã“ã‚Œã ã‘ã§LangGraphã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Ÿè¡Œã§ãã¾ã™ã€‚

```typescript
"use client";

import { useStream } from "@langchain/langgraph-sdk/react";
import type { Message } from "@langchain/langgraph-sdk";

export default function App() {
  const thread = useStream<{ messages: Message[] }>({
    apiUrl: "http://localhost:2024",
    assistantId: "agent",
    messagesKey: "messages",
  });

  return (
    <div>
      <div>
        {thread.messages.map((message) => (
          <div key={message.id}>{message.content as string}</div>
        ))}
      </div>

      <form
        onSubmit={(e) => {
          e.preventDefault();

          const form = e.target as HTMLFormElement;
          const message = new FormData(form).get("message") as string;

          form.reset();
          thread.submit({ messages: [{ type: "human", content: message }] });
        }}
      >
        <input type="text" name="message" />

        {thread.isLoading ? (
          <button key="stop" type="button" onClick={() => thread.stop()}>
            Stop
          </button>
        ) : (
          <button keytype="submit">Send</button>
        )}
      </form>
    </div>
  );
}
```

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç«‹ã¡ã‚ã’ã¾ã™ã€‚
```bash
$ npx @langchain/langgraph-cli dev
warn:    â–ª Launching Python server from @langchain/langgraph-cli is experimental. Please use the `langgraph-cli` package from PyPi instead.
   Built forbiddenfruit==0.1.4
Installed 48 packages in 110ms
INFO:langgraph_api.cli:

        Welcome to

â•¦  â”Œâ”€â”â”Œâ”â”Œâ”Œâ”€â”â•”â•â•—â”¬â”€â”â”Œâ”€â”â”Œâ”€â”â”¬ â”¬
â•‘  â”œâ”€â”¤â”‚â”‚â”‚â”‚ â”¬â•‘ â•¦â”œâ”¬â”˜â”œâ”€â”¤â”œâ”€â”˜â”œâ”€â”¤
â•©â•â•â”´ â”´â”˜â””â”˜â””â”€â”˜â•šâ•â•â”´â””â”€â”´ â”´â”´  â”´ â”´

- ğŸš€ API: http://localhost:2024
- ğŸ¨ Studio UI: https://smith.langchain.com/studio/?baseUrl=http://localhost:2024
- ğŸ“š API Docs: http://localhost:2024/docs

This in-memory server is designed for development and testing.
For production use, please use LangGraph Cloud.
```

![](/images/langgraph-ui/image-3.png)

å®Ÿè¡Œã—ãŸçµæœãŒä»¥ä¸‹ã®å‹•ç”»ã§ã™ã€‚
![](/images/langgraph-ui/image-1.gif)

## é«˜åº¦ãªæ©Ÿèƒ½ã®å®Ÿè£…

åŸºæœ¬çš„ãªãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã«åŠ ãˆã¦ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç·¨é›†æ©Ÿèƒ½
2. AI ã®å¿œç­”ã®å†ç”Ÿæˆæ©Ÿèƒ½

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
`page.tsx`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```typescript
"use client";

import type { Message } from "@langchain/langgraph-sdk";
import { useStream } from "@langchain/langgraph-sdk/react";
import { useState } from "react";

function BranchSwitcher({
  branch,
  branchOptions,
  onSelect,
}: {
  branch: string | undefined;
  branchOptions: string[] | undefined;
  onSelect: (branch: string) => void;
}) {
  if (!branchOptions || !branch) return null;
  const index = branchOptions.indexOf(branch);

  return (
    <div className="flex items-center gap-2">
      <button
        type="button"
        onClick={() => {
          const prevBranch = branchOptions[index - 1];
          if (!prevBranch) return;
          onSelect(prevBranch);
        }}
      >
        Prev
      </button>
      <span>
        {index + 1} / {branchOptions.length}
      </span>
      <button
        type="button"
        onClick={() => {
          const nextBranch = branchOptions[index + 1];
          if (!nextBranch) return;
          onSelect(nextBranch);
        }}
      >
        Next
      </button>
    </div>
  );
}

function EditMessage({
  message,
  onEdit,
}: {
  message: Message;
  onEdit: (message: Message) => void;
}) {
  const [editing, setEditing] = useState(false);

  if (!editing) {
    return (
      <button type="button" onClick={() => setEditing(true)}>
        Edit
      </button>
    );
  }

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault();
        const form = e.target as HTMLFormElement;
        const content = new FormData(form).get("content") as string;

        form.reset();
        onEdit({ type: "human", content });
        setEditing(false);
      }}
    >
      <input name="content" defaultValue={message.content as string} />
      <button type="submit">Save</button>
    </form>
  );
}

export default function App() {
  const thread = useStream({
    apiUrl: "http://localhost:2024",
    assistantId: "agent",
    messagesKey: "messages",
  });

  return (
    <div>
      <div>
        {thread.messages.map((message) => {
          const meta = thread.getMessagesMetadata(message);
          const parentCheckpoint = meta?.firstSeenState?.parent_checkpoint;

          return (
            <div key={message.id}>
              <div>{message.content as string}</div>

              {message.type === "human" && (
                <EditMessage
                  message={message}
                  onEdit={(message) =>
                    thread.submit(
                      { messages: [message] },
                      { checkpoint: parentCheckpoint }
                    )
                  }
                />
              )}

              {message.type === "ai" && (
                <button
                  type="button"
                  onClick={() =>
                    thread.submit(undefined, { checkpoint: parentCheckpoint })
                  }
                >
                  <span>Regenerate</span>
                </button>
              )}

              <BranchSwitcher
                branch={meta?.branch}
                branchOptions={meta?.branchOptions}
                onSelect={(branch) => thread.setBranch(branch)}
              />
            </div>
          );
        })}
      </div>

      <form
        onSubmit={(e) => {
          e.preventDefault();

          const form = e.target as HTMLFormElement;
          const message = new FormData(form).get("message") as string;

          form.reset();
          thread.submit({ messages: [message] });
        }}
      >
        <input type="text" name="message" />

        {thread.isLoading ? (
          <button key="stop" type="button" onClick={() => thread.stop()}>
            Stop
          </button>
        ) : (
          <button key="submit" type="submit">
            Send
          </button>
        )}
      </form>
    </div>
  );
}
```

ä»¥ä¸‹ã®å‹•ç”»ã®ã‚ˆã†ã«å›ç­”ã®å†ç”Ÿæˆã‚‚ã§ãã¾ã™ã—ã€ç·¨é›†ã‚‚`useStream`ã®æ©Ÿèƒ½ã§ç°¡å˜ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](/images/langgraph-ui/image-2.gif)

## ã¾ã¨ã‚

ã“ã®è¨˜äº‹ã§ã¯ã€LangGraph UI ã‚’ä½¿ã£ã¦ AI ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è¦‹ã¦ãã¾ã—ãŸã€‚
LangGraph UI ã¯ã€AI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã‚’å¤§å¹…ã«åŠ¹ç‡åŒ–ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ç‰¹ã«ã€**ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®å®Ÿè£…ã«é©ã—ã¦ã„ã‚‹**ã¨æ€ã„ã¾ã™ã€‚

ã¾ãŸã€LangGraphã§ä½œæˆã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã€LangGraph CloudãŒã‚ã‚Šã€ã“ã‚Œã¯LangSmithã®æœ‰æ–™ãƒ—ãƒ©ãƒ³ã«å…¥ã£ã¦ã„ã‚‹ã¨ä½¿ãˆã‚‹ã‚ˆã†ãªã®ã§ã€æ¬¡å›è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

https://langchain-ai.github.io/langgraph/cloud/quick_start/#deploy-to-langgraph-cloud

:::message
ã€ãŠä»•äº‹ã®ã”ä¾é ¼ã€‘
å¼Šç¤¾ã§ã¯ç”Ÿæˆ AI ã‚’ç”¨ã„ãŸã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã‚’æ”¯æ´ã—ã¦ã„ã¾ã™ã€‚
ã‚‚ã—ãŠä»•äº‹ã®ç›¸è«‡ãŒã‚ã‚Œã°ã“ã¡ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã‚ˆã‚ŠãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„ï¼
https://forms.gle/RW1Kpaxwx64RBmgL6

ãƒ¡ãƒ¼ãƒ«ã§ã®å•ã„åˆã‚ã›ã¯ã“ã¡ã‚‰ã‹ã‚‰ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
sakai.shun@egghead.co.jp
:::
